################################################
#                                              #
#  Model: VGG11                                #
#  Author: vbadenas (victor.badenas@gmail.com) #
#                                              #
################################################

# seeds
seed: 42
__set_seed: !apply:torch.manual_seed [!ref <seed>]
experiment_name: "mit67_vgg11_same"
experiment_folder: "results/mit67_vgg11_same/"
device: "cuda:0"

# data folder
data_folder: ./data/

# training parameters
epochs: 50
batch_size: 8
shuffle: True

num_clases: 67

transform_random_resized_crop: !new:torchvision.transforms.RandomResizedCrop
    size: 224
transform_resize: !new:torchvision.transforms.Resize
    size: [224, 224]
transform_normalize: !new:torchvision.transforms.Normalize
    mean: [0.485, 0.456, 0.406]
    std: [1, 1, 1]


transform_train: !new:torchvision.transforms.Compose
    transforms: [
        !ref <transform_resize>,
        !ref <transform_normalize>
    ]

transform_valid: !new:torchvision.transforms.Compose
    transforms: [
        !ref <transform_resize>,
        !ref <transform_normalize>
    ]

dataset object
train_dataset: !new:frarch.datasets.Mit67
    train: true
    transform: !ref <transform_train>
    full: true

valid_dataset: !new:frarch.datasets.Mit67
    train: false
    transform: !ref <transform_valid>
    full: true


# dataloader options
dataloader_options:
    batch_size: !ref <batch_size>
    shuffle: !ref <shuffle>
    num_workers: 16

opt_class: !name:torch.optim.Adam
    lr: 0.001

loss: !new:torch.nn.CrossEntropyLoss
    weight: !apply:frarch.utils.data.tensorInDevice
        data: [596, 115, 216, 152, 97, 113, 346, 92, 243, 158, 91, 192, 96, 548, 209, 162, 108, 142, 456, 544, 102, 103, 99, 93, 105, 246, 412, 91, 486, 105, 313, 636, 150, 93, 140, 93, 342, 91, 192, 157, 159, 122, 91, 365, 130, 159, 118, 93, 249, 208, 99, 462, 114, 101, 464, 135, 138, 126, 97, 659, 225, 122, 178, 97, 100, 312, 233]
        device: !ref <device>

metrics: !new:frarch.modules.metrics.MetricsWrapper
    classification_error: !new:frarch.modules.metrics.ClassificationError

model: !apply:torchvision.models.vgg11
    num_classes: !ref <num_classes>
    pretrained: False

modules:
    model: !ref <model>

checkpointer: !new:frarch.modules.Checkpointer
    save_path: !ref <experiment_folder>
    reference_metric: "classification_error"
    save_best_only: True
    modules:
        model: !ref <model>
